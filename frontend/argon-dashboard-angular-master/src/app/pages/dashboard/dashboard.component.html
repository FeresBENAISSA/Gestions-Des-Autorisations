<div class="header bg-gradient-info pb-8 pt-5 pt-md-8">
  <div class="container-fluid">
    <div class="header-body">
      <!-- Card stats -->
      <div class="row">
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">
                    Total Permission
                  </h5>
                  <span class="h2 font-weight-bold mb-0">{{
                    totalAutorisations
                  }}</span>
                </div>
                <div class="col-auto">
                  <div
                    class="icon icon-shape bg-primary text-white rounded-circle shadow"
                  >
                    <i class="fas fa-chart-bar"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <!-- <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> 3.48%</span> -->
                <!-- <span class="text-nowrap">Since last month</span> -->
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">
                    Approuved Permission
                  </h5>
                  <span class="h2 font-weight-bold mb-0">{{
                    approuvedAutorisations
                  }}</span>
                </div>
                <div class="col-auto">
                  <div
                    class="icon icon-shape bg-success text-white rounded-circle shadow"
                  >
                    <i class="fas fa-chart-bar"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <!-- <span class="text-danger mr-2"><i class="fas fa-arrow-down"></i> 3.48%</span>
                <span class="text-nowrap">Since last week</span> -->
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">
                    Refused Permission
                  </h5>
                  <span class="h2 font-weight-bold mb-0">{{
                    refusedAutorisations
                  }}</span>
                </div>
                <div class="col-auto">
                  <div
                    class="icon icon-shape bg-danger text-white rounded-circle shadow"
                  >
                    <i class="fas fa-chart-bar"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <!-- <span class="text-warning mr-2"><i class="fas fa-arrow-down"></i> 1.10%</span>
                <span class="text-nowrap">Since yesterday</span> -->
              </p>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6">
          <div class="card card-stats mb-4 mb-xl-0">
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <h5 class="card-title text-uppercase text-muted mb-0">
                    Ongoing Permission
                  </h5>
                  <span class="h2 font-weight-bold mb-0">{{
                    enCoursAutorisations
                  }}</span>
                </div>
                <div class="col-auto">
                  <div
                    class="icon icon-shape bg-custom-warning text-white rounded-circle shadow"
                  >
                    <i class="fas fa-chart-bar"></i>
                  </div>
                </div>
              </div>
              <p class="mt-3 mb-0 text-muted text-sm">
                <!-- <span class="text-success mr-2"><i class="fas fa-arrow-up"></i> 12%</span>
                <span class="text-nowrap">Since last month</span> -->
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- <div class="container-fluid mt--7">
  <div class="row">
    <div class="col-xl-8 mb-5 mb-xl-0">
      
    </div>
    <div class="col-xl-4">
      
    </div>
  </div>
</div> -->

<div class="container-fluid mt--7">
  <div class="row">
    <div class="col-xl-8 mb-5 mb-xl-0">
      <div class="card bg-gradient-default shadow">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase text-light ls-1 mb-1">Overview</h6>
              <h2 class="text-white mb-0">PERMISSIONS</h2>
            </div>
            <div class="col">
              <ul class="nav nav-pills justify-content-end">
                <li
                  class="nav-item mr-2 mr-md-0"
                  data-toggle="chart"
                  data-target="#chart-sales"
                  (click)="data = datasets[0]; updateOptions()"
                >
                  <a
                    href="javascript:void(0)"
                    class="nav-link py-2 px-3"
                    [ngClass]="{ active: clicked === true }"
                    data-toggle="tab"
                    (click)="clicked = true; clicked1 = false"
                  >
                    <span class="d-none d-md-block">{{ currentYear - 1 }}</span>
                    <span class="d-md-none">{{ currentYear - 1 }}</span>
                  </a>
                </li>
                <li
                  class="nav-item"
                  data-toggle="chart"
                  data-target="#chart-sales"
                  (click)="data = datasets[1]; updateOptions()"
                >
                  <a
                    href="javascript:void(0)"
                    class="nav-link py-2 px-3"
                    [ngClass]="{ active: clicked1 === true }"
                    data-toggle="tab"
                    (click)="clicked = false; clicked1 = true"
                  >
                    <span class="d-none d-md-block">{{ currentYear }}</span>
                    <span class="d-md-none">{{ currentYear }}</span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- Chart -->
          <div class="chart">
            <!-- Chart wrapper -->
            <canvas id="chart-sales" class="chart-canvas"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4">
      <div class="card shadow">
        <div class="card-header bg-transparent pt-3 pb-3">
          <div class="row align-items-center">
            <div class="col-lg-6">
              <h6 class="text-uppercase text-muted ls-1 mb-1">summary</h6>
              <h2 class="mb-0">PERMISSIONS</h2>
            </div>
            <div class="col-lg-6">
              <div class="card bg-gradient-default">
                <!-- Card body -->
                <div class="card-body p-1 m-1">
                  <div class="row">
                    <div class="col-8">
                      <h5
                        class="card-title text-uppercase text-muted mb-0 text-white"
                      >
                        All Users
                      </h5>
                      <span class="h2 font-weight-bold mb-0 text-white">{{
                        usersNumber
                      }}</span>
                    </div>
                    <div class="col-4">
                      <div
                        class="icon icon-shape bg-white text-dark rounded-circle shadow float-right"
                      >
                        <i class="ni ni-atom"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart">
            <canvas class="chart-canvas" id="chart-doughnut"> </canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4" hidden>
      <div class="card shadow">
        <div class="card-header bg-transparent">
          <div class="row align-items-center">
            <div class="col">
              <h6 class="text-uppercase text-muted ls-1 mb-1">summary</h6>
              <h2 class="mb-0">PERMISSIONS</h2>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="chart">
            <canvas id="chart-orders" class="chart-canvas"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- --------------filter-------------------- -->
  <div class="row mt-5">
    <div class="col-xl-12 col-lg-12 col-xs-12 mb-2">
      <div class="card shadow">
        <div class="card-header border-0 pb-0">
          <h3 class="">Filter Authorization</h3>
        </div>
        <div class="card-body pt-0">
          <form action="">
            <div class="row">
              <div class="col-xl-6 col-lg-12">
                <label for="date"> DAY</label>
                <div class="form-group">
                  <div class="input-group input-group-alternative">
                    <div class="input-group-prepend">
                      <span class="input-group-text"
                        ><i class="ni ni-calendar-grid-58"></i
                      ></span>
                    </div>
                    <input
                      type="date"
                      placeholder="Datepicker"
                      class="form-control"
                      value="{{ this.date }}"
                      bsDatepicker
                      (change)="filterAutorisation($event.target.value)"
                    />
                  </div>
                </div>
              </div>
              <div class="col-xl-6 col-lg-12">
                <label for="date"> State</label>
                <select
                  class="form-control"
                  (change)="filterAutorisation($event.target.value)"
                  data-toggle="select"
                  title="Simple select"
                  data-live-search="true"
                  data-live-search-placeholder="Search ..."
                  id="selectr1"
                >
                  <option value="Approved">Approved</option>
                  <option value="Refused">Refused</option>
                  <option selected value="En Cours">En Cours</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="col-xl-12 col-lg-12 col-xs-12">
      <div class="card shadow">
        <div class="card-header border-0">
          <h3 class="mb-0">Authorizations</h3>
        </div>
        <div class="table-responsive">
          <table class="table align-items-center table-flush mb-4">
            <thead class="thead-light">
              <tr>
                <th scope="col">Id Auto</th>
                <th scope="col">Full Name</th>
                <th scope="col">Description</th>
                <th scope="col">Etat</th>
                <th scope="col">StartHour</th>
                <th scope="col">End hour</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let autorisation of filteredAutorisation
                    | paginate
                      : {
                          itemsPerPage: 5,
                          currentPage: currentPage1,
                          id: 'first'
                        };
                  let i = index
                "
              >
                <td scope="row">
                  {{ autorisation.idAuto }}
                </td>
                <td>
                  {{ autorisation.user.name }}
                </td>
                <td>
                  {{ autorisation.description }}
                </td>
                <td>
                  <span
                    class="badge badge badge-pill badge-lg badge-custom-warning mr-4"
                    *ngIf="autorisation.state == 'En Cours'"
                    ><i class="bg-custom-warning"></i> {{ autorisation.state }}
                  </span>
                  <span
                    class="badge badge badge-pill badge-md badge-success mr-4"
                    *ngIf="autorisation.state == 'Approved'"
                    ><i class="bg-success"></i>{{ autorisation.state }}
                  </span>
                  <span
                    class="badge badge badge-pill badge-md badge-danger mr-4"
                    *ngIf="autorisation.state == 'Refused'"
                    ><i class="bg-danger"></i>{{ autorisation.state }}
                  </span>
                </td>
                <td>
                  {{ autorisation.exitTime }}
                </td>
                <td>
                  {{ autorisation.returnTime }}
                </td>
                <td>
                  <div class="col-4 " ><button class="btn btn-success btn-icon btn-sm " rel="tooltip" type="button" (click)="onOpen('Edit',edit, autorisation.idAuto)" [disabled]="autorisation.state == 'Approved' || autorisation.state=='Refused'" ><i class="fa fa-edit"></i></button></div>
                  
                </td>
              </tr>
            </tbody>
          </table>
          
          <pagination-controls
            (pageChange)="currentPage1 = $event"
            
            id="first"
          ></pagination-controls>

          <div *ngIf="filteredDataExist">
            <div class="alert alert-danger m-5" role="alert">
              <strong>Error!</strong> There is no Authorizations where date =
              {{ date }} and state = {{ state }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-5">
    <div class="col-xl-12 col-lg-12 col-xs-12 mb-2">
      <div class="card shadow">
        <div class="card-header border-0 pb-0">
          <h3 class="">Filter Users</h3>
        </div>
        <div class="card-body pt-0">
          <form action="">
            <div class="row">
              <div class="col-xl-6 col-lg-12">
                <label for="date"> Users</label>
                <select
                  class="form-control"
                  data-toggle="select"
                  title="Simple select"
                  data-live-search="true"
                  data-live-search-placeholder="Search ..."
                  id="userSelect"
                  (change)="getAutorisationByUsername($event.target.value)"
                >
                  <!-- (change)="filterAutorisation($event.target.value)" -->
                  <option selected disabled value="null">
                    Select Users to show stats
                  </option>
                  <option
                    *ngFor="let user of users"
                    value="{{ user.username }}"
                  >
                    {{ user.name }}
                  </option>
                </select>
              </div>
              <div class="col-xl-6 col-lg-12">
                <label for="date"> State</label>
                <select 
                  class="form-control"
                  data-toggle="select"
                  [(ngModel)]="stateForUser"
                  title="Simple select"
                  data-live-search="true"
                  data-live-search-placeholder="Search ..."
                  id="selectStateForUser"
                  (change)="
                    filterAutorisationByStateForUser($event.target.value)
                  "
                >
                  <option value="All">ALL</option>
                  <option value="Approved">Approved</option>
                  <option value="Refused">Refused</option>
                  <option value="En Cours">En Cours</option>
                </select>
              </div>
            </div>
          </form>
          <div class="row mt-3">
            <div class="col-lg-3 mt-2">
              <div class="card bg-primary">
                <!-- Card body -->
                <div class="card-body p-1 m-1">
                  <div class="row">
                    <div class="col-8">
                      <h5
                        class="card-title text-uppercase text-muted mb-0 text-white"
                      >
                        TOTAL PERMISSION
                      </h5>
                      <span class="h2 font-weight-bold mb-0 text-white">{{
                        totalAutorisationByUser
                      }}</span>
                    </div>
                    <div class="col-4">
                      <div
                        class="icon icon-shape bg-white text-dark rounded-circle shadow float-right"
                      >
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 mt-2">
              <div class="card bg-success">
                <!-- Card body -->
                <div class="card-body p-1 m-1">
                  <div class="row">
                    <div class="col-8">
                      <h5
                        class="card-title text-uppercase text-muted mb-0 text-white"
                      >
                        APPROUVED PERMISSION
                      </h5>
                      <span class="h2 font-weight-bold mb-0 text-white">{{
                        approuvedAutorisationsByUser
                      }}</span>
                    </div>
                    <div class="col-4">
                      <div
                        class="icon icon-shape bg-white text-dark rounded-circle shadow float-right"
                      >
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 mt-2">
              <div class="card bg-warning">
                <!-- Card body -->
                <div class="card-body p-1 m-1">
                  <div class="row">
                    <div class="col-8">
                      <h5
                        class="card-title text-uppercase text-muted mb-0 text-white"
                      >
                        REFUSED PERMISSION
                      </h5>
                      <span class="h2 font-weight-bold mb-0 text-white">{{
                        refusedAutorisationsByUser
                      }}</span>
                    </div>
                    <div class="col-4">
                      <div
                        class="icon icon-shape bg-white text-dark rounded-circle shadow float-right"
                      >
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-3 mt-2">
              <div class="card bg-custom-warning">
                <!-- Card body -->
                <div class="card-body p-1 m-1">
                  <div class="row">
                    <div class="col-8">
                      <h5
                        class="card-title text-uppercase text-muted mb-0 text-white"
                      >
                        ONGOING PERMISSION
                      </h5>
                      <span class="h2 font-weight-bold mb-0 text-white">
                        {{ enCoursAutorisationsByUser }}</span
                      >
                    </div>
                    <div class="col-4">
                      <div
                        class="icon icon-shape bg-white text-dark rounded-circle shadow float-right"
                      >
                        <i class="ni ni-chart-bar-32"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-12 col-lg-12 col-xs-12">
      <div class="card shadow">
        <div class="card-header border-0">
          <h3 class="mb-0">Users stats</h3>
        </div>
        <div class="table-responsive">
          <table datatable class="table align-items-center table-flush mb-4">
            <thead class="thead-light">
              <tr>
                <th scope="col">Id Auto</th>
                <th scope="col">Full Name</th>
                <th scope="col">Description</th>
                <th scope="col">Date</th>
                <th scope="col">Etat</th>
                <th scope="col">StartHour</th>
                <th scope="col">End hour</th>
                <th>actions</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="
                  let autorisation of filteredAutorisationByUser
                    | paginate
                      : {
                          itemsPerPage: 5,
                          currentPage: currentPage2,
                          totalLenght: totalAutorisationByUser,
                          id: 'second'
                        };
                  let i = index
                "
              >
                <td scope="row">
                  {{ autorisation.idAuto }}
                </td>
                <td>
                  {{ autorisation.user.name }}
                </td>
                <td>
                  {{ autorisation.description }}
                </td>
                <td>
                  {{ autorisation.date }}
                </td>
                <td>
                  <span
                    class="badge badge badge-pill badge-lg badge-custom-warning mr-4"
                    *ngIf="autorisation.state == 'En Cours'"
                    ><i class="bg-custom-warning"></i> {{ autorisation.state }}
                  </span>
                  <span
                    class="badge badge badge-pill badge-md badge-success mr-4"
                    *ngIf="autorisation.state == 'Approved'"
                    ><i class="bg-success"></i>{{ autorisation.state }}
                  </span>
                  <span
                    class="badge badge badge-pill badge-md badge-danger mr-4"
                    *ngIf="autorisation.state == 'Refused'"
                    ><i class="bg-danger"></i>{{ autorisation.state }}
                  </span>
                </td>
                <td>
                  {{ autorisation.exitTime }}
                </td>
                <td>
                  {{ autorisation.returnTime }}
                </td>
                <td>
                  <div class="col-4 " ><button class="btn btn-success btn-icon btn-sm " rel="tooltip" type="button" (click)="onOpen('Edit',edit, autorisation.idAuto)" [disabled]="autorisation.state == 'Approved' || autorisation.state=='Refused'" ><i class="fa fa-edit"></i></button></div>
                </td>
              </tr>
            </tbody>
          </table>
          <pagination-controls
            (pageChange)="currentPage2 = $event"
            id="second"
          ></pagination-controls>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #edit let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Update State</h4>
      <button type="button" class="btn-sm btn-outline-danger " aria-label="Close" (click)="modal.dismiss('Cross click')">X</button>
    </div>
    <div class="modal-body">
        <div class="card-body">
          <form  >
            <div class="form-group bmd-form-group">
                <div class="input-group">
                    <input type="text" class="form-control"  disabled placeholder="{{rowData.user.name}}"  disabled>
                </div>
            </div>
    
            <div class="form-group bmd-form-group">
                <div class="input-group">
                  <input type="date" class="form-control"   value="{{rowData.date|date:'yyyy-MM-dd'}}"  placeholder="{{rowData.date|date:'yyyy-MM-dd'}}" ngModel="{{rowData.date|date:'yyyy-MM-dd'}}" name="date" required disabled>
                </div>
            </div>
    
            <div class="form-group bmd-form-group">
                    <div class="input-group">
                      <input type="time" placeholder="startTime" class="form-control" value="{{rowData.exitTime}}"ngModel="{{rowData.exitTime}}" name="startTime" required disabled>
                  </div>
            </div>
            <div class="form-group bmd-form-group">
                    <div class="input-group">
                      <input type="time" placeholder="endTime" class="form-control" value="{{rowData.returnTime}}" ngModel="{{rowData.returnTime}}" name="endTime" required disabled>
                  </div>
            </div>
            <div class="form-group bmd-form-group">
                    <div class="input-group">
                      <input type="text" placeholder="Description" class="form-control" value="{{rowData.description}}" ngModel="{{rowData.description}}" name="Description" required disabled>
                  </div>
            </div> 
        </form>
        
        </div>
        <div class="modal-footer">
          <button type="submit"  class="btn btn-outline-danger" (click)="Refused()">Refused </button>
          <button type="submit" class="btn btn-success" (click)="Approved()">Approved</button>
        </div>
    </div>
  </ng-template>
